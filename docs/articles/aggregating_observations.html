<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aggregating some observations in a data frame • dplyrx</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Aggregating some observations in a data frame">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dplyrx</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aggregating_observations.html">Aggregating some observations in a data frame</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/epix-project/dplyrx">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Aggregating some observations in a data frame</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epix-project/dplyrx/blob/master/vignettes/aggregating_observations.Rmd"><code>vignettes/aggregating_observations.Rmd</code></a></small>
      <div class="hidden name"><code>aggregating_observations.Rmd</code></div>

    </div>

    
    
<p>A common task when working on spatio-temporal data frames is aggregating the observations of some variables, either in space, or in time. This can be done easilty with the <code>aggregate_by</code> function of the <code>dplyrx</code> package. Let’s load it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyrx)
<span class="co">#&gt; Le chargement a nécessité le package : dplyr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="co">#&gt; Le chargement a nécessité le package : magrittr</span>
<span class="co">#&gt; Le chargement a nécessité le package : purrr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'purrr'</span>
<span class="co">#&gt; The following object is masked from 'package:magrittr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     set_names</span>
<span class="co">#&gt; Le chargement a nécessité le package : rlang</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'rlang'</span>
<span class="co">#&gt; The following objects are masked from 'package:purrr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     %@%, %||%, as_function, flatten, flatten_chr, flatten_dbl,</span>
<span class="co">#&gt;     flatten_int, flatten_lgl, invoke, list_along, modify, prepend,</span>
<span class="co">#&gt;     rep_along, splice</span>
<span class="co">#&gt; The following object is masked from 'package:magrittr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     set_names</span></code></pre></div>
<p>To understand it better what the function can help do let’s have a look at the following meteorological data from the <code>dplyrx</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(meteo)
meteo
<span class="co">#&gt;    year     month station temperature humidity rainfall sunshine</span>
<span class="co">#&gt; 1  2013   January Can Tho   26.145161     26.2     15.1    209.5</span>
<span class="co">#&gt; 2  2013       May Can Tho   28.941935     32.3    169.1    232.3</span>
<span class="co">#&gt; 3  2013 September Can Tho   27.076667     30.5    336.7    155.9</span>
<span class="co">#&gt; 4  2014   January Can Tho   24.738710     23.1      1.4    223.2</span>
<span class="co">#&gt; 5  2014       May Can Tho   29.348387     32.1    197.1    251.0</span>
<span class="co">#&gt; 6  2014 September Can Tho   27.316667     30.2    298.1    199.5</span>
<span class="co">#&gt; 7  2015   January Can Tho   25.200000     24.3      0.0    227.7</span>
<span class="co">#&gt; 8  2015       May Can Tho   29.500000     31.4    168.3    278.5</span>
<span class="co">#&gt; 9  2015 September Can Tho   27.700000     30.9    288.6    207.8</span>
<span class="co">#&gt; 10 2013   January  Da Lat   16.103226     14.6      5.0    224.8</span>
<span class="co">#&gt; 11 2013       May  Da Lat   20.070968     19.9    268.6    194.2</span>
<span class="co">#&gt; 12 2013 September  Da Lat   18.300000     18.8    389.7     83.5</span>
<span class="co">#&gt; 13 2014   January  Da Lat   14.793548     13.0      5.9    237.6</span>
<span class="co">#&gt; 14 2014       May  Da Lat   19.851613     20.0    325.6    185.3</span>
<span class="co">#&gt; 15 2014 September  Da Lat   18.760000     19.6    341.5    127.8</span>
<span class="co">#&gt; 16 2015   January  Da Lat   15.500000     13.9      0.1    260.6</span>
<span class="co">#&gt; 17 2015       May  Da Lat   20.100000     20.1    282.2    174.5</span>
<span class="co">#&gt; 18 2015 September  Da Lat   19.200000     19.4    252.9    119.2</span>
<span class="co">#&gt; 19 2013   January Da Nang   21.922581     21.9     17.8    126.1</span>
<span class="co">#&gt; 20 2013       May Da Nang   29.161290     30.6     43.3    288.3</span>
<span class="co">#&gt; 21 2013 September Da Nang   27.126667     30.2    750.8    145.3</span>
<span class="co">#&gt; 22 2014   January Da Nang   20.300000     19.5     86.6    104.3</span>
<span class="co">#&gt; 23 2014       May Da Nang   29.335484     30.4      5.5    280.2</span>
<span class="co">#&gt; 24 2014 September Da Nang   28.686667     31.0    111.5    225.2</span>
<span class="co">#&gt; 25 2015   January Da Nang   21.200000     20.4     24.2    151.5</span>
<span class="co">#&gt; 26 2015       May Da Nang   29.900000     30.9     34.6    281.7</span>
<span class="co">#&gt; 27 2015 September Da Nang   28.900000     31.3    416.0    240.0</span>
<span class="co">#&gt; 28 2013   January   Sa Pa    7.441935      9.9     44.8     62.1</span>
<span class="co">#&gt; 29 2013       May   Sa Pa   19.377419     18.9    401.1    165.9</span>
<span class="co">#&gt; 30 2013 September   Sa Pa   17.056667     17.7    300.0     95.3</span>
<span class="co">#&gt; 31 2014   January   Sa Pa    7.790323      9.4     11.6    128.0</span>
<span class="co">#&gt; 32 2014       May   Sa Pa   20.151613     18.4    118.3    208.0</span>
<span class="co">#&gt; 33 2014 September   Sa Pa   18.533333     20.1    346.2     99.4</span>
<span class="co">#&gt; 34 2015   January   Sa Pa    9.200000      9.9    112.1    143.0</span>
<span class="co">#&gt; 35 2015       May   Sa Pa   21.300000     18.1    297.6    250.6</span>
<span class="co">#&gt; 36 2015 September   Sa Pa   19.300000     19.8    301.4     72.2</span></code></pre></div>
<p>This data set contains the values of temperature (°C), absolute humidity (g / m<span class="math inline">\(^3\)</span>), rainfall (mm) and hours of sunshine from 3 meteorological stations (Can Tho, Da Lat and Da Nang) for the months of January, May and September in 2013, 2014 and 2015. From here, imagine that you want to aggretate all the observations of the stations Can Tho and Da Lat. An obvious way to do so is probably to take the mean. This can be done so in two step with the package <code>dplyr</code> and with the <code>aggregate_by</code> function of the <code>dplyrx</code> package: First, we need to <code>recode</code> the stations selected with the same value and then used the <code>aggregate_by</code> function on the output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
meteo <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">station =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/recode.html">recode</a></span>(station, <span class="st">`</span><span class="dt">Can Tho</span><span class="st">`</span> =<span class="st"> "group_prov"</span>, <span class="st">`</span><span class="dt">Da Lat</span><span class="st">`</span>=<span class="st"> "group_prov"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/aggregate_by.html">aggregate_by</a></span>(station, month, year, <span class="dt">.funs =</span> mean)
<span class="co">#&gt; # A tibble: 27 x 7</span>
<span class="co">#&gt; # Groups:   station, month [?]</span>
<span class="co">#&gt;    station    month      year temperature humidity rainfall sunshine</span>
<span class="co">#&gt;    &lt;fct&gt;      &lt;ord&gt;     &lt;int&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 group_prov January    2013        21.1     20.4    10.0      217.</span>
<span class="co">#&gt;  2 group_prov January    2014        19.8     18.0     3.65     230.</span>
<span class="co">#&gt;  3 group_prov January    2015        20.4     19.1     0.05     244.</span>
<span class="co">#&gt;  4 group_prov May        2013        24.5     26.1   219.       213.</span>
<span class="co">#&gt;  5 group_prov May        2014        24.6     26.0   261.       218.</span>
<span class="co">#&gt;  6 group_prov May        2015        24.8     25.8   225.       226.</span>
<span class="co">#&gt;  7 group_prov September  2013        22.7     24.6   363.       120.</span>
<span class="co">#&gt;  8 group_prov September  2014        23.0     24.9   320.       164.</span>
<span class="co">#&gt;  9 group_prov September  2015        23.4     25.2   271.       164.</span>
<span class="co">#&gt; 10 Da Nang    January    2013        21.9     21.9    17.8      126.</span>
<span class="co">#&gt; # ... with 17 more rows</span></code></pre></div>
<p>The second argument are listed all the variables that should be used to identify unique observations to aggregate in each of the stations Can Tho and Da Lat. Here we want aggregate by space but keep the temporal information contained in the variables <code>month</code> and <code>year</code>.</p>
<p>The last argument, <code>.funs</code> specifies the function that should be used to perform the aggregation. By default it’s <code>sum</code> but here it makes more sense to do <code>mean</code>.</p>
<p>We can naturally aggregate the observations and apply the function on <code>temperature</code> and <code>humidity</code> only, the argument <code>.funs</code> need to be specify as a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">meteo <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">station =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/recode.html">recode</a></span>(station, <span class="st">`</span><span class="dt">Can Tho</span><span class="st">`</span> =<span class="st"> "group_prov"</span>, <span class="st">`</span><span class="dt">Da Lat</span><span class="st">`</span>=<span class="st"> "group_prov"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/aggregate_by.html">aggregate_by</a></span>(station, month, year, <span class="dt">.funs =</span> <span class="kw">list</span>(<span class="kw">mean</span>(temperature, humidity)))
<span class="co">#&gt; # A tibble: 27 x 5</span>
<span class="co">#&gt; # Groups:   station, month [?]</span>
<span class="co">#&gt;    station    month      year `mean(temperature)` `mean(humidity)`</span>
<span class="co">#&gt;    &lt;fct&gt;      &lt;ord&gt;     &lt;int&gt;               &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 group_prov January    2013                21.1             20.4</span>
<span class="co">#&gt;  2 group_prov January    2014                19.8             18.0</span>
<span class="co">#&gt;  3 group_prov January    2015                20.4             19.1</span>
<span class="co">#&gt;  4 group_prov May        2013                24.5             26.1</span>
<span class="co">#&gt;  5 group_prov May        2014                24.6             26.0</span>
<span class="co">#&gt;  6 group_prov May        2015                24.8             25.8</span>
<span class="co">#&gt;  7 group_prov September  2013                22.7             24.6</span>
<span class="co">#&gt;  8 group_prov September  2014                23.0             24.9</span>
<span class="co">#&gt;  9 group_prov September  2015                23.4             25.2</span>
<span class="co">#&gt; 10 Da Nang    January    2013                21.9             21.9</span>
<span class="co">#&gt; # ... with 17 more rows</span></code></pre></div>
<div id="a-more-complex-situation" class="section level2">
<h2 class="hasAnchor">
<a href="#a-more-complex-situation" class="anchor"></a>A more complex situation</h2>
<p>Let’s now consider the case where, with the <code>meteo</code> data set, instead of performing a spatial aggregation we want to perform a temporal aggregation. Let’s imagine for example that we want to aggregate the months of January and May for all the provinces. What’s apparent here is that the proper way of performing such an aggregation for the variables <code>temperature</code> and <code>humidity</code> would probably to use the <code>mean</code> function whereas it would certainly make more sense to use the <code>sum</code> function for the variables <code>rainfall</code> and <code>sunshine</code>. The pipeline below shows how to do so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">meteo <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">station =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/recode.html">recode</a></span>(month, <span class="st">`</span><span class="dt">January</span><span class="st">`</span> =<span class="st"> "group_month"</span>, <span class="st">`</span><span class="dt">May</span><span class="st">`</span>=<span class="st"> "group_month"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/aggregate_by.html">aggregate_by</a></span>(station, month, year, <span class="dt">.funs =</span> <span class="kw">list</span>(<span class="kw">mean</span>(temperature, humidity), <span class="kw">sum</span>(rainfall, sunshine)))
<span class="co">#&gt; # A tibble: 9 x 7</span>
<span class="co">#&gt; # Groups:   station, month [?]</span>
<span class="co">#&gt;   station   month   year `mean(temperatu… `mean(humidity)` `sum(rainfall)`</span>
<span class="co">#&gt;   &lt;ord&gt;     &lt;ord&gt;  &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 group_mo… Janua…  2013             17.9             18.2            82.7</span>
<span class="co">#&gt; 2 group_mo… Janua…  2014             16.9             16.2           105. </span>
<span class="co">#&gt; 3 group_mo… Janua…  2015             17.8             17.1           136. </span>
<span class="co">#&gt; 4 group_mo… May     2013             24.4             25.4           882. </span>
<span class="co">#&gt; 5 group_mo… May     2014             24.7             25.2           646. </span>
<span class="co">#&gt; 6 group_mo… May     2015             25.2             25.1           783. </span>
<span class="co">#&gt; 7 September Septe…  2013             22.4             24.3          1777. </span>
<span class="co">#&gt; 8 September Septe…  2014             23.3             25.2          1097. </span>
<span class="co">#&gt; 9 September Septe…  2015             23.8             25.4          1259. </span>
<span class="co">#&gt; # ... with 1 more variable: `sum(sunshine)` &lt;dbl&gt;</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#a-more-complex-situation">A more complex situation</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://marcchoisy.free.fr">Marc Choisy</a>, Lucie Contamin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
